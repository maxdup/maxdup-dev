/*! For license information please see 728.e91e58e1104604a52922.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[728],{728:function(t,e,n){n.d(e,{l:function(){return at}});var r={main:0,mountain:1,network:2,montreal:3};var a=function(){var t=this;this.dottedness=1,this.nodeness=0,this.gridness=0,this.toponess=0;var e=1,n=0,a=0,i=0,o=.3;this.update=function(r){var s=r/o,c=function(t,e){return t==e?t:t>e?Math.max(0,t-s):Math.min(1,t+s)};t.dottedness=c(t.dottedness,e),t.nodeness=c(t.nodeness,n),t.gridness=c(t.gridness,a),t.toponess=c(t.toponess,i)},this.target=function(s,c){switch(o=c,r[s]){case r.mountain:t.activeScene=s,e=1,n=0,a=1,i=0;break;case r.network:t.activeScene=s,e=1,n=1,a=0,i=0;break;case r.montreal:t.activeScene=s,e=1,n=0,a=0,i=1;break;case r.main:t.activeScene=s;default:e=1,n=0,a=0,i=0}}};function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t){for(var e=new Array(Math.pow(t,2)).fill(0),n=0;n<t;n++)e[t*n+n]=1;return e}function c(t,e){for(var n=e[0],r=e[1],a=e[2],i=0;i<4;i++)t[i+12]=t[i]*n+t[i+4]*r+t[i+8]*a+t[i+12];return t}function f(t,e,n){var r=i(t),a=n[0],o=n[1],s=n[2],c=Math.hypot(a,o,s);if(!(c<1e-6)){a*=c=1/c,o*=c,s*=c;var f=Math.sin(e),l=Math.cos(e),u=1-l,h=new Array(9).fill(0);h[0]=a*a*u+l,h[1]=o*a*u+s*f,h[2]=s*a*u-o*f,h[3]=a*o*u-s*f,h[4]=o*o*u+l,h[5]=s*o*u+a*f,h[6]=a*s*u+o*f,h[7]=o*s*u-a*f,h[8]=s*s*u+l;for(var d=0;d<3;d++)for(var v=0;v<4;v++)r[4*d+v]=t[v]*h[3*d]+t[4+v]*h[1+3*d]+t[8+v]*h[2+3*d];return r}}var l=function(){var t=this,e=c(s(4),[-.5,0,-6]);this.pjMatrix=null,this.mvMatrix=e,this.viewWidth=null,this.viewHeight=null,this.renderScale=1,this.renderHeight=null,this.renderWidth=null,this.resized=!1,this.pitch=0,this.pitchOffset=0,this.yaw=0,this.yawOffset=0,this.roll=0,this.offsetX=-.5,this.offsetY=0,this.offsetZ=-6,this.updateNudge=function(e,r){t.pitchOffset=.05*e,t.yawOffset=.05*r,n()},this.updateAngle=function(e,r,a,i,o,s){t.pitch=e,t.yaw=r,t.roll=a,t.offsetX=i,t.offsetY=o,t.offsetZ=s,n()},this.updateRenderScale=function(e){e!=t.renderScale&&(t.renderScale=e,r())},this.updateSize=function(e,n){e==t.viewWidth&&n==t.viewHeight||(t.viewWidth=e,t.viewHeight=n,r(),t.aspectRatio=e/n,a(),t.resized=!0)};var n=function(){t.mvMatrix=c(s(4),[t.offsetX,t.offsetY,t.offsetZ]),t.mvMatrix=f(t.mvMatrix,t.pitch+t.pitchOffset,[1,0,0]),t.mvMatrix=f(t.mvMatrix,t.yaw+t.yawOffset,[0,1,0]),t.mvMatrix=f(t.mvMatrix,t.roll,[0,0,1])},r=function(){t.renderWidth=t.viewWidth*t.renderScale,t.renderHeight=t.viewHeight*t.renderScale},a=function(){t.pjMatrix=function(t,e,n,r){var a=new Array(16).fill(0),i=1/Math.tan(t/2);if(a[0]=i/e,a[5]=i,a[11]=-1,null!=r&&r!==1/0){var o=1/(n-r);a[10]=(r+n)*o,a[14]=2*r*n*o}else a[10]=-1,a[14]=-2*n;return a}(45,t.aspectRatio,.1,1e3)};this.offset=0,this.positions=[1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1],this.len=8};var u=function(t){var e=this;this.camera=t,this.targetFPS=60;var n=!1,r=!1,a=0,i=Date.now(),o=0,s=0,c=null,f=Date.now(),l=0;this.timeDelta=0,this.fixedTimeDelta=0,this.frameReady=function(){return f=Date.now(),(l=f-i)>o},this.frameStart=function(){i=f-l%o,e.timeDelta=l/1e3},this.frameEnd=function(){var t=Date.now()-f;c=c||t,s++,c+=(t-c)/s,e.evalFrameTime()},this.evalFrameTime=function(){s<3*e.targetFPS||(2*c>1/e.targetFPS*1e3&&!n&&(e.decreaseRenderQuality(),r=!1),6*c<1/e.targetFPS*1e3&&!r&&a<6&&(a++,e.increaseRenderQuality(),n=!1))},this.decreaseRenderQuality=function(){s=0,c=null,60!=e.targetFPS?1!=e.camera.renderScale&&.75!=e.camera.renderScale?n=!0:e.camera.updateRenderScale(.5):e.setFPS(30)},this.increaseRenderQuality=function(){s=0,c=null,.5!=e.camera.renderScale?.75!=e.camera.renderScale?(1==e.camera.renderScale&&30==e.targetFPS&&e.setFPS(60),r=!0):e.camera.updateRenderScale(1):e.camera.updateRenderScale(.75)},this.setFPS=function(t){t!=e.targetFPS&&(e.targetFPS=t,u())};var u=function(){o=1e3/e.targetFPS,e.fixedTimeDelta=.1/(e.targetFPS/30)/3*2};u()},h="uniform mat4 pjMatrix;\nuniform mat4 mvMatrix;\nuniform float screenScale;\n\nuniform vec2 sheens[6];\nuniform float nodeness; // 0≤r≤1 transition\nuniform float gridness; // 0≤r≤1 transition\nuniform float toponess; // 0≤r≤1 transition\n\nattribute vec3 position;\nattribute float nconnection;\nattribute vec2 topology;\nattribute float height;\n\nvarying vec4 vColor;\nvarying float isDotted;\nvarying float isLined;\nvarying vec2 texcoord;\n\nconst float maxDist = 3.0;\nconst float minPSize = 0.2;\nconst float maxPSize = 0.65;\nconst float connPSize = 1.5;\nconst float connHOffs = 0.075;\n\n\nconst vec3 distSharpness = vec3(4.0, 4.0, 5.0);\nconst vec3 distWidth = vec3(0.8, 0.8, 1.5);\nconst mat3 LINE_COLORS = %lineColors%;\n\n\nfloat demap(float val, float minOut, float maxOut){\n  return clamp((val - minOut) / (maxOut - minOut), 0.0, 1.0);\n}\nvec3 remap(vec3 val, float minOut, mat3 maxOut){\n  return clamp(val, vec3(0.0), vec3(1.0)) * (maxOut - minOut) + minOut;\n}\nvec3 easeInOut(vec3 x, vec3 p){\n  vec3 xp = pow(clamp(x, 0.0, 1.0), p);\n  return xp / (xp + pow(1.0 - x, p));\n}\nfloat distToVec(vec2 point, vec2 angle, vec2 origin){\n  return abs(dot(point - origin, normalize(vec2(angle.y,-angle.x))));\n}\nfloat distToVecAlt(vec2 P, vec2 slope, vec2 O){\n    vec2 D = normalize(slope);\n    vec2 X = D * dot(P-O, D) + O;\n    return abs(distance(P, X));\n}\n\nfloat fogged(float z){\n  const float fogstarts = 4.0;\n  const float fogends = 8.0;\n  return clamp((z - fogstarts) / (fogends - fogstarts), 0.0, 1.0);\n}\n\nvoid main()\n{\n  float isGrided = 1.0 - abs(sign(nconnection));  // [0, 1]\n  float isNoded = max(0.0, sign(nconnection)); // [0, 1]\n  float isTopoed = clamp(-nconnection - 1.0, 0.0, 1.0); // [0, 1]\n\n  float nodeFactor = isNoded * nodeness; // 0≤r≤1 transition\n  float topoFactor = isTopoed * toponess; // 0≤r≤1 transition\n\n  // Effect calcs - grid\n  float gridHeight = max(0.0, position.z - height);\n  float gridHeightOffset = gridHeight * gridness; // 0≤r≤gridHeight\n\n  // Effect calcs - nodes\n  float connFactor = nodeFactor * nconnection; // 0≤r≤1\n  float nodeHeightOffset = connHOffs * connFactor; // [0, 0.075]\n  float nodeRadiusOffset = connPSize * connFactor; // [0, 1.5]\n\n  // Effect calcs - topography\n  float topoAlphaMask = max(1.0 - toponess, (toponess * topology.y * 2.0));\n  float topoDotSize = (topology.y - 0.75) * toponess * 1.4; // need opt\n  float topoHeightFreeze = topology.y * -0.5 + 1.0;\n  float topoHeightTarget = max(-0.1, topology.x - 0.6) * 0.65 * toponess; // need opt\n  float topoHeightOffset = (height * topoHeightFreeze + topoHeightTarget - height) * toponess;\n\n  isDotted = clamp(1.0 - gridHeightOffset, nodeFactor, 1.0); // 0≤r≤1\n  isLined = clamp(min(1.0, (gridHeightOffset* 3.0)) * isGrided, max(topoFactor, nodeFactor), 1.0);\n\n  // POSITION\n  float z = height + gridHeightOffset + nodeHeightOffset + topoHeightOffset;\n  gl_Position = pjMatrix * mvMatrix * vec4(position.x, z, position.y, 1.0);\n\n  // POINT SIZE\n  float agnosticPointSize = mix(minPSize, maxPSize, min(z * 5.0, 1.0));\n  float scale = screenScale * .01;\n  gl_PointSize = isDotted * max(agnosticPointSize + nodeRadiusOffset, topoDotSize) * scale;\n\n  // COLORS\n  float minZ = vec4(pjMatrix * mvMatrix * vec4(0.0, 0.0, 0.0, 1.0)).z;\n  float maxZ = vec4(pjMatrix * mvMatrix * vec4(-maxDist, 0.0, -maxDist, 1.0)).z;\n  float fog = 1.0 - gridness * fogged(gl_Position.z);\n\n  vec3 vdist = vec3(distToVec(position.xy, sheens[1], sheens[0]),\n                    distToVec(position.xy, sheens[3], sheens[2]),\n                    distToVec(position.xy, sheens[5], sheens[4]));\n\n  vec3 distVec = min((vdist + distWidth) / maxDist, 1.0);\n  distVec = 1.0 - easeInOut(distVec, distSharpness);\n\n  vColor = vec4(remap(distVec, 0.35, LINE_COLORS), topoAlphaMask * fog);\n}\n",d="precision mediump float;\nvarying vec4 vColor;\nvarying float isLined;\n\nvoid main() // LINES\n{\n  gl_FragColor = vec4(vColor.rgb, isLined);\n}\n";function v(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function m(t){return t*t*t*(t*(6*t-15)+10)}function p(t,e,n){return e+t*(n-e)}function y(t,e,n){var r=15&t,a=r<8?e:n,i=r<4?n:12===r||14===r?e:0;return(1&r?-a:a)+(2&r?-i:i)}function S(t){var e=1e4*Math.sin(t);return e-Math.floor(e)}var b=Date.now();var w=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t*=n,e*=n;var a=255&Math.floor(t),i=255&Math.floor(e),o=t-Math.floor(t),s=e-Math.floor(e),c=m(o),f=m(s),l=function(t){for(var e=[],n=0;n<256;n++)e[n]=n;for(var r=255;r>0;r--){var a=Math.floor(S(t+r)*(r+1)),i=[e[a],e[r]];e[r]=i[0],e[a]=i[1]}return e.concat(e)}(b),u=[].concat(v(l),v(l)),h=u[u[a]+i],d=u[u[a]+i+1],g=u[u[a+1]+i],w=u[u[a+1]+i+1],A=p(c,y(h,o,s),y(g,o-1,s)),x=p(c,y(d,o,s-1),y(w,o-1,s-1));return p(f,A,x)*r},A=51;function x(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function M(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var c=r&&r.prototype instanceof s?r:s,f=Object.create(c.prototype);return P(f,"_invoke",function(n,r,a){var i,s,c,f=0,l=a||[],u=!1,h={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,s=0,c=t,h.n=n,o}};function d(n,r){for(s=n,c=r,e=0;!u&&f&&!a&&e<l.length;e++){var a,i=l[e],d=h.p,v=i[2];n>3?(a=v===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=d&&((a=n<2&&d<i[1])?(s=0,h.v=r,h.n=i[1]):d<v&&(a=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,h.n=v,s=0))}if(a||n>1)return o;throw u=!0,r}return function(a,l,v){if(f>1)throw TypeError("Generator is already running");for(u&&1===l&&d(l,v),s=l,c=v;(e=s<2?t:c)||!u;){i||(s?s<3?(s>1&&(h.n=-1),d(s,c)):h.n=c:h.v=c);try{if(f=2,i){if(s||(a="next"),e=i[a]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=t}else if((e=(u=h.n<0)?c:n.call(r,h))!==o)break}catch(e){i=t,s=1,c=e}finally{f=1}}return{value:e,done:u}}}(n,a,i),!0),f}var o={};function s(){}function c(){}function f(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(P(e={},r,function(){return this}),e),u=f.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,P(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return c.prototype=f,P(u,"constructor",f),P(f,"constructor",c),c.displayName="GeneratorFunction",P(f,a,"GeneratorFunction"),P(u),P(u,a,"Generator"),P(u,r,function(){return this}),P(u,"toString",function(){return"[object Generator]"}),(M=function(){return{w:i,m:h}})()}function P(t,e,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}P=function(t,e,n,r){function i(e,n){P(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},P(t,e,n,r)}function F(t,e,n,r,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function O(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function o(t){F(i,r,a,o,s,"next",t)}function s(t){F(i,r,a,o,s,"throw",t)}o(void 0)})}}Math.floor(A/2);var E,R,_,D,C,L,z,I,k,H,j,B=[],N=null,U=[],W=null,Y=[],V=!1;var G=function(t,e,r,a,i,o,s,c){var f=this;this.scene=t,this.camera=e,this.ticker=r,this.waves=a,this.grid=i,this.nodes=o,this.roads=s,this.sheens=c,this.grid.offset=this.waves.len,this.nodes.offset=this.waves.len+this.grid.len,this.roads.offset=this.waves.len+this.grid.len+this.nodes.len,new Array(A*A),this.loseCTX=function(){R.loseContext()},this.initWebGL=function(t){C=t,E=t.getContext("webgl")||t.getContext("experimental-webgl"),R=E.getExtension("WEBGL_lose_context"),t.addEventListener("webglcontextrestored",f.start),t.addEventListener("webglcontextlost",function(t){t.preventDefault(),setTimeout(function(){R.restoreContext()})},!1)},this.initTextures=function(t){D=t,_=t.getContext("2d",{willReadFrequently:!0})},this.initShaders=function(){W=E.createProgram(),N=E.createProgram(),E.createProgram();var t=E.createShader(E.VERTEX_SHADER),e=E.createShader(E.VERTEX_SHADER),n=E.createShader(E.FRAGMENT_SHADER),r=E.createShader(E.FRAGMENT_SHADER),a=E.createShader(E.FRAGMENT_SHADER);h=h.replace(/\%lineColors\%/g,"mat3("+f.sheens.str+")"),E.shaderSource(t,h),E.shaderSource(e,"uniform mat4 pjMatrix;\nuniform mat4 mvMatrix;\nuniform float screenScale;\n\nattribute vec3 debugPosition;\n\nvarying vec4 vColor;\nvarying float isDotted;\nvarying float isLined;\n\nvoid main()\n{\n\n  // POS\n  vec4 pos = vec4(debugPosition.x, debugPosition.y, debugPosition.z, 1.0);\n  gl_Position = pjMatrix * mvMatrix * pos;\n\n  // SCALE\n  float scale = screenScale / 100.0;\n  gl_PointSize = 1.0 * scale;\n\n  // COLOR\n  isDotted = 1.0;\n  isLined = 1.0;\n  vColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n"),E.shaderSource(n,d),E.shaderSource(r,"precision mediump float;\nvarying vec4 vColor;\nvarying float isDotted;\n\nfloat circle(in vec2 _st){\n  vec2 dist = _st-vec2(0.5);\n  return 1.-smoothstep(0.8, 1.1, dot(dist,dist)*6.0);\n}\n\nvoid main() // DOTS\n{\n  gl_FragColor = vColor * vec4(1.0, 1.0, 1.0, isDotted * circle(gl_PointCoord.xy));\n}\n"),E.shaderSource(a,d),E.compileShader(t),E.compileShader(e),E.compileShader(n),E.compileShader(r),E.compileShader(a),E.attachShader(N,t),E.attachShader(N,n),E.attachShader(W,t),E.attachShader(W,r),E.linkProgram(W),E.linkProgram(N),E.disable(E.DEPTH_TEST),E.enable(E.BLEND),E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA)};var l=function(){var t=O(M().m(function t(){var e,r,a,i;return M().w(function(t){for(;;)switch(t.n){case 0:return i=fetch,t.n=1,n.e(309).then(n.t.bind(n,309,17));case 1:return t.n=2,i(t.v.default,{mode:"cors"});case 2:return e=t.v,t.n=3,e.blob();case 3:return r=t.v,t.n=4,createImageBitmap(r,{premultiplyAlpha:"none",colorSpaceConversion:"none"});case 4:return a=t.v,D.width=a.width,D.height=a.height,_.drawImage(a,0,0,a.width,a.height),t.a(2,Array.from({length:A*A},function(t,e){var n=Math.floor(e/A),r=e%A,a=n/A*D.width,i=r/A*D.height,o=_.getImageData(a,i,1,1);return[o.data[1]/256,o.data[2]/256]}).flat())}},t)}));return function(){return t.apply(this,arguments)}}(),u=function(t,e){for(var n=0;n<t.length;n++)t[n]=f.waves.heights[e[n]]},v=function(){var t=O(M().m(function t(){var e,n,r,a;return M().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,l();case 1:return e=t.v,n=p(f.grid.idTable,e,2),r=p(f.nodes.idTable,e,2),a=p(f.roads.idTable,e,2),t.a(2,[].concat(x(e),x(n),x(r),x(a)))}},t)}));return function(){return t.apply(this,arguments)}}(),g=function(){var t=Array.from({length:A*A},function(t,e){var n=Math.floor(e/A),r=e%A,a=Math.sin((n/A*1.25-.125)*Math.PI)*Math.sin((r/A*1.25-.125)*Math.PI)*2.75-1.25;return[.12*(-A/2+n),.12*(-A/2+r),(4*a+w(n/A*20,r/A*15,.3)+1.5*w(n/A*20,r/A*15,.85))/4]}).flat(),e=p(f.nodes.idTable,t,3),n=p(f.grid.idTable,t,3),r=p(f.roads.idTable,t,3);return[].concat(x(t),x(n),x(e),x(r))},m=function(){for(var t,e,n,r=g(),a=(t=new Array(f.grid.idTable.length).fill(0),e=p(f.nodes.idTable,f.nodes.connections,1),n=new Array(f.roads.idTable.length).fill(-2),[].concat(x(f.nodes.connections),x(t),x(e),x(n))),i=[],o=0;o<a.length;o++)i.push(r[3*o]),i.push(r[3*o+1]),i.push(r[3*o+2]),i.push(a[o]);return i};function p(t,e,n){for(var r=new Array(t.length),a=0;a<t.length;a++)for(var i=0;i<n;i++)r[a*n+i]=e[t[a]*n+i];return r}function y(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)for(var a=0;a<e;a++)n[r*e+a]=t[r]*e+a;return n}this.initBuffers=function(){function t(t,e){e[0]=E.getUniformLocation(t,"pjMatrix"),e[1]=E.getUniformLocation(t,"mvMatrix"),e[2]=E.getUniformLocation(t,"screenScale"),e[3]=E.getUniformLocation(t,"sheens"),e[4]=E.getUniformLocation(t,"nodeness"),e[5]=E.getUniformLocation(t,"gridness"),e[6]=E.getUniformLocation(t,"toponess")}var e,n,r,a=function(){var t=O(M().m(function t(){var e,n,r;return M().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,v();case 1:e=t.v,z=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,z),E.bufferData(E.ARRAY_BUFFER,new Float32Array(e),E.STATIC_DRAW),n=2*Float32Array.BYTES_PER_ELEMENT,r=n,B[2]=E.getAttribLocation(W,"topology"),E.enableVertexAttribArray(B[2]),E.vertexAttribPointer(B[2],2,E.FLOAT,!1,r,0);case 2:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}();(function(){var t=m();L=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,L),E.bufferData(E.ARRAY_BUFFER,new Float32Array(t),E.STATIC_DRAW);var e=3*Float32Array.BYTES_PER_ELEMENT,n=0+e,r=e+1*Float32Array.BYTES_PER_ELEMENT;B[0]=E.getAttribLocation(W,"position"),E.enableVertexAttribArray(B[0]),E.vertexAttribPointer(B[0],3,E.FLOAT,!1,r,0),B[1]=E.getAttribLocation(W,"nconnection"),E.enableVertexAttribArray(B[1]),E.vertexAttribPointer(B[1],1,E.FLOAT,!1,r,n)})(),a(),k=new Float32Array(new Array(4*f.sheens.array.length).fill(0)),e=p(f.grid.idTable,f.waves.heights,1),n=p(f.nodes.idTable,f.waves.heights,1),r=p(f.roads.idTable,f.waves.heights,1),H=new Float32Array([].concat(x(f.waves.heights),x(e),x(n),x(r))),j=function(){var t=y(f.grid.idTable,1),e=y(f.nodes.idTable,1),n=y(f.roads.idTable,1);return x(Array(f.waves.heights.length).keys()).concat(x(t),x(e),x(n))}(),u(H,j),I=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,I),E.bufferData(E.ARRAY_BUFFER,new Float32Array(H),E.DYNAMIC_DRAW),B[3]=E.getAttribLocation(W,"height"),E.enableVertexAttribArray(B[3]),E.vertexAttribPointer(B[3],1,E.FLOAT,!1,Float32Array.BYTES_PER_ELEMENT,0),E.useProgram(W),t(W,Y),f.setImage(),E.useProgram(N),t(N,U)},this.setImage=O(M().m(function t(){return M().w(function(t){for(;;)switch(t.n){case 0:V;case 1:return t.a(2)}},t)})),this.render=function(){if(requestAnimationFrame(f.render),f.ticker.frameReady()){f.ticker.frameStart(),f.camera.resized&&(C.width=f.camera.viewWidth,C.height=f.camera.viewHeight,E.viewport(0,0,f.camera.viewWidth,f.camera.viewHeight),f.camera.resized=!1),f.scene.update(f.ticker.timeDelta),f.sheens.update(f.ticker.timeDelta),f.waves.update(f.ticker.fixedTimeDelta),function(t){for(var e=0;e<f.sheens.array.length;e++)t[4*e]=f.sheens.array[e].origin[0],t[4*e+1]=f.sheens.array[e].origin[1],t[4*e+2]=f.sheens.array[e].angle[0],t[4*e+3]=f.sheens.array[e].angle[1]}(k),u(H,j);var t=function(t){E.uniformMatrix4fv(t[0],!1,f.camera.pjMatrix),E.uniformMatrix4fv(t[1],!1,f.camera.mvMatrix),E.uniform1f(t[2],f.camera.renderHeight),E.uniform2fv(t[3],k),E.uniform1f(t[4],f.scene.nodeness),E.uniform1f(t[5],f.scene.gridness),E.uniform1f(t[6],f.scene.toponess)};E.useProgram(W),E.bindBuffer(E.ARRAY_BUFFER,I),E.bufferSubData(E.ARRAY_BUFFER,0,H),t(Y),E.drawArrays(E.POINTS,f.waves.offset,f.waves.len),E.useProgram(N),E.bindBuffer(E.ARRAY_BUFFER,I),t(U),E.drawArrays(E.LINES,f.grid.offset,f.grid.len+f.roads.len+f.nodes.len),E.flush(),f.ticker.frameEnd()}},this.start=function(){f.initBuffers(),f.render()}},X=Math.floor(A/2);var Z=function(){var t=this,e=new Array(3),n=0,r=!0,a=.033;this.setInertia=function(t){n=t},this.setPositions=function(i){var c=i.x,f=i.y,l=i.z,u=i.sigma2;if(r)for(var h=0;h<3;h++){e[h]=new Array(A);for(var d=0;d<A;d++)e[h][d]=new Array(A)}for(var v=0;v<3;v++)for(var g=0;g<A;g++)for(var m=0;m<A;m++){var p=6*(-X+g),y=6*(-X+m),S=l*Math.exp(-(Math.pow(p-c,2)+Math.pow(y-f,2))/(2*u));e[0][g][m]=r||Math.abs(S)>Math.abs(e[0][g][m])?S:e[0][g][m]}for(var b=1;b<50;b++)for(var w=1;w<50;w++)e[1][b][w]=n*e[0][b][w]+8*a*a/1*(e[0][b+1][w]+e[0][b-1][w]+e[0][b][w+1]+e[0][b][w-1]-4*e[0][b][w]);o(1),s(1),r=!1,t.heights=new Array(A*A)},this.update=function(t){a=t;for(var r=1;r<A/2;r++)for(var c=1;c<A/2;c++)e[2][r][c]=n*(2*e[1][r][c]-e[0][r][c]+16*a*a/1*(e[1][r+1][c]+e[1][r-1][c]+e[1][r][c+1]+e[1][r][c-1]-4*e[1][r][c])),e[2][A-r-1][A-c-1]=e[2][r][c],e[2][r][A-c-1]=e[2][r][c],e[2][A-r-1][c]=e[2][r][c];o(2),s(2),i()};var i=function(){for(var n=0;n<A;n++)for(var r=0;r<A;r++)e[0][n][r]=e[1][n][r],e[1][n][r]=e[2][n][r],t.heights[n*A+r]=.02*e[1][n][r]},o=function(t){for(var n=1;n<50;n++)e[t][n][0]=e[t][n][1],e[t][n][50]=e[t][n][49],e[t][0][n]=e[t][1][n],e[t][50][n]=e[t][49][n]},s=function(t){e[t][0][0]=(e[t][0][1]+e[t][1][0])/2,e[t][0][50]=(e[t][0][49]+e[t][1][50])/2,e[t][50][0]=(e[t][49][0]+e[t][50][1])/2,e[t][50][50]=(e[t][49][50]+e[t][50][49])/2};this.offset=0,this.len=A*A};var Q=function(){for(var t=0,e=new Array(7600),n=0;n<A;n++)for(var r=0;r<A;r++)n<50&&(e[t++]=n*A+r,e[t++]=(n+1)*A+r),n<50&&r<50&&(e[t++]=n*A+r,e[t++]=(n+1)*A+r+1),r<50&&(e[t++]=n*A+r,e[t++]=n*A+r+1);this.offset=0,this.idTable=e,this.len=e.length};var $=function(){var t=this,e=[];this.connections=new Array(A*A).fill(0);for(var n=0;n<A*A;n++)this.connections[n]=Math.max(0,Math.floor(64*Math.random())-62);for(var r=function(n,r){if(t.connections[r]>0)return e.push(n),e.push(r),!0},a=0;a<A;a++)for(var i=0;i<A;i++){var o=a*A+i;if(0!=this.connections[o])for(var s=0,c=0;s<this.connections[o]+1&&c<A;){for(var f=0;f<c;f++){var l=i+f,u=a+c-f,h=a-c+f;l<A&&u<A&&r(o,u*A+l)&&s++,l<A&&h>=0&&r(o,h*A+l)&&s++}c++}}this.offset=0,this.len=e.length,this.idTable=e},q=[40,295,295,446,446,647,647,749,749,1051,1051,1407,1407,1509,1509,1610,1610,1658,1658,1706,1706,1857,1857,2005,2005,2104,2104,2252,2252,2300,2300,2348,2348,2346,1632,1639,1639,1900,1900,2055,2055,2209,2209,2569,51,882,882,883,883,1038,1038,1140,1140,1453,1453,1606,1606,1658,26,126,126,329,329,327,327,528,528,675,675,776,776,925,925,1076,1076,1074,1074,1326,204,931,931,986,986,988,988,1041,1041,1197,1197,1248,1248,1508,1508,1610,1610,1714,1714,1869,45,146,146,195,195,397,397,954,954,1158,1158,1413,1413,1669,1669,1920,1920,2020,2020,2070,2070,2168,2168,2166,2166,2313,2313,2310,2310,2358,2358,2456,2456,2403,2403,2450,2450,2448,1768,1869,1869,1968,1968,2067,2067,2065,2065,2113,2113,2111,2111,2209,2209,2257,2257,2304,2304,2399,2399,2450,18,272,272,377,377,429,429,583,583,636,636,788,788,838,838,1040,1040,1141,1141,1241,1241,1342,1342,1392,1392,1543,1543,1641,1641,1639,628,889,889,1099,1099,1307,1307,1411,1411,1412,1158,1259,1259,1409,1409,1509,816,869,869,971,971,1076,1076,1129,1129,1234,1234,1392,1392,1548,1548,1652,1652,1755,1755,2065,2584,2329,2329,2175,2175,2022,2022,2020,1325,1471,1471,1623,1623,1672,1672,1669,2022,1973,1973,1824,1824,1672,2070,2224,2224,2175,2578,2426,2426,2325,2325,2224,2567,2469,2469,2419,2419,2370,2370,2320,2320,2322,2322,2377,2377,2430,2430,2484,2484,2487,2487,2389,2389,2341,2341,2293,2293,2294,1623,1776,1776,1930,1930,2084,2084,2238,2238,2341,1631,1782,1782,1881,1881,1930,1543,1752,1752,1958,1958,2113];var J=function(){this.offset=0,this.idTable=q,this.len=this.idTable.length};function K(t,e,n){return(n-e)*t+e}var tt=[[1,0,.2],[.2,.8,.4],[1,1,1]],et=Array.from({length:9},function(t,e){return tt[e%3][Math.floor(e/3)]}).join();var nt=function(){var t=this;this.str=et,this.array=[{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0},{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0},{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0}],this.respawn=!1,this.active=!1,this.nextWave=null,this.set=function(e){t.active=!0,void 0!==(null==e?void 0:e.respawn)&&(t.respawn=e.respawn);var n=K(Math.random(),10,70)/45*2;if(t.array.forEach(function(t){var e=K((Math.random()+1)/2,-1.5,1.5);t.inactive=!1,t.speed=K(n/3+e,1,4),t.angle=[4*e-n,1],t.origin=[-4-4*e,-4-4*e]}),e&&e.sheens)for(var r=0;r<e.sheens.length;r++)Object.assign(t.array[r],e.sheens[r]);clearTimeout(t.nextWave)},this.update=function(n){t.active&&(t.active=!1,t.array.forEach(function(r){!r.inactive&&e(r,n),t.active=t.active||!r.inactive}),!t.active&&t.respawn&&(t.nextWave=setTimeout(t.set,2e3+3e3*Math.random())))};var e=function(t,e){var n=t.speed*e;t.angle[0]=Math.min(-.25,t.angle[0]+n/10),t.origin[0]+=n,t.origin[1]+=n,t.inactive=Math.max(t.origin[0],t.origin[1])>4}},rt={initialize:0,start:1,setSize:2,setInertia:3,setPositions:4,setSheens:5,setFPS:6,setProgress:7,setScene:8,loseCTX:9,setCamOffset:10,setCamAngle:11};var at=new function(){var t=new a,e=new l,n=new u(e),r=new Z,i=new Q,o=new nt,s=new $,c=new J,f=new G(t,e,n,r,i,s,c,o);return this.init=function(t,e){f.initWebGL(t),f.initTextures(e),f.initShaders()},this.run=function(a,i){switch(rt[a]){case rt.start:f.start();break;case rt.setSize:e.updateSize(i.width,i.height);break;case rt.setProgress:f.setProgress(i);break;case rt.setCamOffset:e.updateNudge(i.pitchOffset,i.yawOffset);break;case rt.setCamAngle:e.updateAngle(i.pitch,i.yaw,i.roll,i.offsetX,i.offsetY,i.offsetZ);break;case rt.setInertia:r.setInertia(1-i*n.targetFPS/30);break;case rt.setPositions:r.setPositions(i);break;case rt.setSheens:o.set(i);break;case rt.setScene:t.target(i.name,i.speed);break;case rt.setFPS:n.setFPS(i);break;case rt.loseCTX:f.loseCTX()}},this}}}]);