/*! For license information please see 728.ad99a43945e80561ec6e.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[728],{728:function(t,e,n){n.d(e,{l:function(){return ot}});var r={main:0,mountain:1,network:2,montreal:3};var o=function(){var t=this;this.dottedness=1,this.nodeness=0,this.gridness=0,this.toponess=0;var e=1,n=0,o=0,a=0,i=.3;this.update=function(r){var s=r/i,c=function(t,e){return t==e?t:t>e?Math.max(0,t-s):Math.min(1,t+s)};t.dottedness=c(t.dottedness,e),t.nodeness=c(t.nodeness,n),t.gridness=c(t.gridness,o),t.toponess=c(t.toponess,a)},this.target=function(s,c){switch(i=c,r[s]){case r.mountain:t.activeScene=s,e=1,n=0,o=1,a=0;break;case r.network:t.activeScene=s,e=1,n=1,o=0,a=0;break;case r.montreal:t.activeScene=s,e=1,n=0,o=0,a=1;break;case r.main:t.activeScene=s;default:e=1,n=0,o=0,a=0}}};function a(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t){for(var e=new Array(Math.pow(t,2)).fill(0),n=0;n<t;n++)e[t*n+n]=1;return e}function c(t,e){for(var n=e[0],r=e[1],o=e[2],a=0;a<4;a++)t[a+12]=t[a]*n+t[a+4]*r+t[a+8]*o+t[a+12];return t}function f(t,e,n){var r=a(t),o=n[0],i=n[1],s=n[2],c=Math.hypot(o,i,s);if(!(c<1e-6)){o*=c=1/c,i*=c,s*=c;var f=Math.sin(e),l=Math.cos(e),u=1-l,h=new Array(9).fill(0);h[0]=o*o*u+l,h[1]=i*o*u+s*f,h[2]=s*o*u-i*f,h[3]=o*i*u-s*f,h[4]=i*i*u+l,h[5]=s*i*u+o*f,h[6]=o*s*u+i*f,h[7]=i*s*u-o*f,h[8]=s*s*u+l;for(var d=0;d<3;d++)for(var v=0;v<4;v++)r[4*d+v]=t[v]*h[3*d]+t[4+v]*h[1+3*d]+t[8+v]*h[2+3*d];return r}}var l=function(){var t=this,e=c(s(4),[-.5,0,-6]);this.pjMatrix=null,this.mvMatrix=e,this.viewWidth=null,this.viewHeight=null,this.renderScale=1,this.renderHeight=null,this.renderWidth=null,this.resized=!1,this.pitch=0,this.pitchOffset=0,this.yaw=0,this.yawOffset=0,this.roll=0,this.offsetX=-.5,this.offsetY=0,this.offsetZ=-6,this.updateNudge=function(e,r){t.pitchOffset=.05*e,t.yawOffset=.05*r,n()},this.updateAngle=function(e,r,o,a,i,s){t.pitch=e,t.yaw=r,t.roll=o,t.offsetX=a,t.offsetY=i,t.offsetZ=s,n()},this.updateRenderScale=function(e){e!=t.renderScale&&(t.renderScale=e,r())},this.updateSize=function(e,n){e==t.viewWidth&&n==t.viewHeight||(t.viewWidth=e,t.viewHeight=n,r(),t.aspectRatio=e/n,o(),t.resized=!0)};var n=function(){t.mvMatrix=c(s(4),[t.offsetX,t.offsetY,t.offsetZ]),t.mvMatrix=f(t.mvMatrix,t.pitch+t.pitchOffset,[1,0,0]),t.mvMatrix=f(t.mvMatrix,t.yaw+t.yawOffset,[0,1,0]),t.mvMatrix=f(t.mvMatrix,t.roll,[0,0,1])},r=function(){t.renderWidth=t.viewWidth*t.renderScale,t.renderHeight=t.viewHeight*t.renderScale},o=function(){t.pjMatrix=function(t,e,n,r){var o=new Array(16).fill(0),a=1/Math.tan(t/2);if(o[0]=a/e,o[5]=a,o[11]=-1,null!=r&&r!==1/0){var i=1/(n-r);o[10]=(r+n)*i,o[14]=2*r*n*i}else o[10]=-1,o[14]=-2*n;return o}(45,t.aspectRatio,.1,1e3)};this.offset=0,this.positions=[1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1],this.len=8};var u=function(t){var e=this;this.camera=t,this.targetFPS=60;var n=!1,r=!1,o=0,a=Date.now(),i=0,s=0,c=null,f=Date.now(),l=0;this.timeDelta=0,this.fixedTimeDelta=0,this.frameReady=function(){return f=Date.now(),(l=f-a)>i},this.frameStart=function(){a=f-l%i,e.timeDelta=l/1e3},this.frameEnd=function(){var t=Date.now()-f;c=c||t,s++,c+=(t-c)/s,e.evalFrameTime()},this.evalFrameTime=function(){s<3*e.targetFPS||(2*c>1/e.targetFPS*1e3&&!n&&(e.decreaseRenderQuality(),r=!1),6*c<1/e.targetFPS*1e3&&!r&&o<6&&(o++,e.increaseRenderQuality(),n=!1))},this.decreaseRenderQuality=function(){s=0,c=null,60!=e.targetFPS?1!=e.camera.renderScale&&.75!=e.camera.renderScale?n=!0:e.camera.updateRenderScale(.5):e.setFPS(30)},this.increaseRenderQuality=function(){s=0,c=null,.5!=e.camera.renderScale?.75!=e.camera.renderScale?(1==e.camera.renderScale&&30==e.targetFPS&&e.setFPS(60),r=!0):e.camera.updateRenderScale(1):e.camera.updateRenderScale(.75)},this.setFPS=function(t){t!=e.targetFPS&&(e.targetFPS=t,u())};var u=function(){i=1e3/e.targetFPS,e.fixedTimeDelta=.1/(e.targetFPS/30)/3*2};u()},h="uniform mat4 pjMatrix;\nuniform mat4 mvMatrix;\nuniform float screenScale;\n\nuniform vec2 sheens[6];\nuniform float nodeness; // 0≤r≤1 transition\nuniform float gridness; // 0≤r≤1 transition\nuniform float toponess; // 0≤r≤1 transition\n\nattribute vec3 position;\nattribute float nconnection;\nattribute vec2 topology;\nattribute float height;\n\nvarying vec4 vColor;\nvarying float isDotted;\nvarying float isLined;\nvarying vec2 texcoord;\n\nconst float maxDist = 3.0;\nconst float minPSize = 0.2;\nconst float maxPSize = 0.65;\nconst float connPSize = 1.5;\nconst float connHOffs = 0.075;\n\n\nconst vec3 distSharpness = vec3(4.0, 4.0, 5.0);\nconst vec3 distWidth = vec3(0.8, 0.8, 1.5);\nconst mat3 LINE_COLORS = %lineColors%;\n\n\nfloat demap(float val, float minOut, float maxOut){\n  return clamp((val - minOut) / (maxOut - minOut), 0.0, 1.0);\n}\nvec3 remap(vec3 val, float minOut, mat3 maxOut){\n  return clamp(val, vec3(0.0), vec3(1.0)) * (maxOut - minOut) + minOut;\n}\nvec3 easeInOut(vec3 x, vec3 p){\n  vec3 xp = pow(clamp(x, 0.0, 1.0), p);\n  return xp / (xp + pow(1.0 - x, p));\n}\nfloat distToVec(vec2 point, vec2 angle, vec2 origin){\n  return abs(dot(point - origin, normalize(vec2(angle.y,-angle.x))));\n}\nfloat distToVecAlt(vec2 P, vec2 slope, vec2 O){\n    vec2 D = normalize(slope);\n    vec2 X = D * dot(P-O, D) + O;\n    return abs(distance(P, X));\n}\n\nfloat fogged(float z){\n  const float fogstarts = 4.0;\n  const float fogends = 8.0;\n  return clamp((z - fogstarts) / (fogends - fogstarts), 0.0, 1.0);\n}\n\nvoid main()\n{\n  float isGrided = 1.0 - abs(sign(nconnection));  // [0, 1]\n  float isNoded = max(0.0, sign(nconnection)); // [0, 1]\n  float isTopoed = clamp(-nconnection - 1.0, 0.0, 1.0); // [0, 1]\n\n  float nodeFactor = isNoded * nodeness; // 0≤r≤1 transition\n  float topoFactor = isTopoed * toponess; // 0≤r≤1 transition\n\n  // Effect calcs - grid\n  float gridHeight = max(0.0, position.z - height);\n  float gridHeightOffset = gridHeight * gridness; // 0≤r≤gridHeight\n\n  // Effect calcs - nodes\n  float connFactor = nodeFactor * nconnection; // 0≤r≤1\n  float nodeHeightOffset = connHOffs * connFactor; // [0, 0.075]\n  float nodeRadiusOffset = connPSize * connFactor; // [0, 1.5]\n\n  // Effect calcs - topography\n  float topoAlphaMask = max(1.0 - toponess, (toponess * topology.y * 2.0));\n  float topoDotSize = (topology.y - 0.75) * toponess * 1.4; // need opt\n  float topoHeightFreeze = topology.y * -0.5 + 1.0;\n  float topoHeightTarget = max(-0.1, topology.x - 0.6) * 0.65 * toponess; // need opt\n  float topoHeightOffset = (height * topoHeightFreeze + topoHeightTarget - height) * toponess;\n\n  isDotted = clamp(1.0 - gridHeightOffset, nodeFactor, 1.0); // 0≤r≤1\n  isLined = clamp(min(1.0, (gridHeightOffset* 3.0)) * isGrided, max(topoFactor, nodeFactor), 1.0);\n\n  // POSITION\n  float z = height + gridHeightOffset + nodeHeightOffset + topoHeightOffset;\n  gl_Position = pjMatrix * mvMatrix * vec4(position.x, z, position.y, 1.0);\n\n  // POINT SIZE\n  float agnosticPointSize = mix(minPSize, maxPSize, min(z * 5.0, 1.0));\n  float scale = screenScale * .01;\n  gl_PointSize = isDotted * max(agnosticPointSize + nodeRadiusOffset, topoDotSize) * scale;\n\n  // COLORS\n  float minZ = vec4(pjMatrix * mvMatrix * vec4(0.0, 0.0, 0.0, 1.0)).z;\n  float maxZ = vec4(pjMatrix * mvMatrix * vec4(-maxDist, 0.0, -maxDist, 1.0)).z;\n  float fog = 1.0 - gridness * fogged(gl_Position.z);\n\n  vec3 vdist = vec3(distToVec(position.xy, sheens[1], sheens[0]),\n                    distToVec(position.xy, sheens[3], sheens[2]),\n                    distToVec(position.xy, sheens[5], sheens[4]));\n\n  vec3 distVec = min((vdist + distWidth) / maxDist, 1.0);\n  distVec = 1.0 - easeInOut(distVec, distSharpness);\n\n  vColor = vec4(remap(distVec, 0.35, LINE_COLORS), topoAlphaMask * fog);\n}\n",d="precision mediump float;\nvarying vec4 vColor;\nvarying float isLined;\n\nvoid main() // LINES\n{\n  gl_FragColor = vec4(vColor.rgb, isLined);\n}\n";function v(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function p(t){return t*t*t*(t*(6*t-15)+10)}function m(t,e,n){return e+t*(n-e)}function y(t,e,n){var r=15&t,o=r<8?e:n,a=r<4?n:12===r||14===r?e:0;return(1&r?-o:o)+(2&r?-a:a)}function w(t){var e=1e4*Math.sin(t);return e-Math.floor(e)}var b=Date.now();var S=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t*=n,e*=n;var o=255&Math.floor(t),a=255&Math.floor(e),i=t-Math.floor(t),s=e-Math.floor(e),c=p(i),f=p(s),l=function(t){for(var e=[],n=0;n<256;n++)e[n]=n;for(var r=255;r>0;r--){var o=Math.floor(w(t+r)*(r+1)),a=[e[o],e[r]];e[r]=a[0],e[o]=a[1]}return e.concat(e)}(b),u=[].concat(v(l),v(l)),h=u[u[o]+a],d=u[u[o]+a+1],g=u[u[o+1]+a],S=u[u[o+1]+a+1],x=m(c,y(h,i,s),y(g,i-1,s)),A=m(c,y(d,i,s-1),y(S,i-1,s-1));return m(f,x,A)*r},x=51;function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function E(t){return function(t){if(Array.isArray(t))return P(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return P(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function T(){T=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),s=new _(r||[]);return o(i,"_invoke",{value:F(t,n,s)}),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",v="executing",g="completed",p={};function m(){}function y(){}function w(){}var b={};f(b,i,(function(){return this}));var S=Object.getPrototypeOf,x=S&&S(S(D([])));x&&x!==n&&r.call(x,i)&&(b=x);var E=w.prototype=m.prototype=Object.create(b);function P(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(o,a,i,s){var c=u(t[o],t,a);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"==A(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,i,s)}),(function(t){n("throw",t,i,s)})):e.resolve(l).then((function(t){f.value=t,i(f)}),(function(t){return n("throw",t,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function F(e,n,r){var o=h;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=O(s,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var f=u(e,n,r);if("normal"===f.type){if(o=r.done?g:d,f.arg===p)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(o=g,r.method="throw",r.arg=f.arg)}}}function O(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var a=u(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,p;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function D(e){if(e||""===e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(A(e)+" is not iterable")}return y.prototype=w,o(E,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:y,configurable:!0}),y.displayName=f(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},P(M.prototype),f(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new M(l(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(E),f(E,c,"Generator"),f(E,i,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=D,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),f=r.call(i,"finallyLoc");if(c&&f){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!f)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}function M(t,e,n,r,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function F(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){M(a,r,o,i,s,"next",t)}function s(t){M(a,r,o,i,s,"throw",t)}i(void 0)}))}}Math.floor(x/2);var O,L,R,_,D,k,C,I,z,H,j,N=[],B=null,U=[],Y=null,W=[],G=!1;var V=function(t,e,r,o,a,i,s,c){var f=this;this.scene=t,this.camera=e,this.ticker=r,this.waves=o,this.grid=a,this.nodes=i,this.roads=s,this.sheens=c,this.grid.offset=this.waves.len,this.nodes.offset=this.waves.len+this.grid.len,this.roads.offset=this.waves.len+this.grid.len+this.nodes.len,new Array(x*x),this.loseCTX=function(){L.loseContext()},this.initWebGL=function(t){D=t,O=t.getContext("webgl")||t.getContext("experimental-webgl"),L=O.getExtension("WEBGL_lose_context"),t.addEventListener("webglcontextrestored",f.start),t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),setTimeout((function(){L.restoreContext()}))}),!1)},this.initTextures=function(t){_=t,R=t.getContext("2d",{willReadFrequently:!0})},this.initShaders=function(){Y=O.createProgram(),B=O.createProgram(),O.createProgram();var t=O.createShader(O.VERTEX_SHADER),e=O.createShader(O.VERTEX_SHADER),n=O.createShader(O.FRAGMENT_SHADER),r=O.createShader(O.FRAGMENT_SHADER),o=O.createShader(O.FRAGMENT_SHADER);h=h.replace(/\%lineColors\%/g,"mat3("+f.sheens.str+")"),O.shaderSource(t,h),O.shaderSource(e,"uniform mat4 pjMatrix;\nuniform mat4 mvMatrix;\nuniform float screenScale;\n\nattribute vec3 debugPosition;\n\nvarying vec4 vColor;\nvarying float isDotted;\nvarying float isLined;\n\nvoid main()\n{\n\n  // POS\n  vec4 pos = vec4(debugPosition.x, debugPosition.y, debugPosition.z, 1.0);\n  gl_Position = pjMatrix * mvMatrix * pos;\n\n  // SCALE\n  float scale = screenScale / 100.0;\n  gl_PointSize = 1.0 * scale;\n\n  // COLOR\n  isDotted = 1.0;\n  isLined = 1.0;\n  vColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n"),O.shaderSource(n,d),O.shaderSource(r,"precision mediump float;\nvarying vec4 vColor;\nvarying float isDotted;\n\nfloat circle(in vec2 _st){\n  vec2 dist = _st-vec2(0.5);\n  return 1.-smoothstep(0.8, 1.1, dot(dist,dist)*6.0);\n}\n\nvoid main() // DOTS\n{\n  gl_FragColor = vColor * vec4(1.0, 1.0, 1.0, isDotted * circle(gl_PointCoord.xy));\n}\n"),O.shaderSource(o,d),O.compileShader(t),O.compileShader(e),O.compileShader(n),O.compileShader(r),O.compileShader(o),O.attachShader(B,t),O.attachShader(B,n),O.attachShader(Y,t),O.attachShader(Y,r),O.linkProgram(Y),O.linkProgram(B),O.disable(O.DEPTH_TEST),O.enable(O.BLEND),O.blendFunc(O.SRC_ALPHA,O.ONE_MINUS_SRC_ALPHA)};var l=function(){var t=F(T().mark((function t(){var e,r,o;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=fetch,t.next=3,n.e(309).then(n.t.bind(n,309,17));case 3:return t.t1=t.sent.default,t.t2={mode:"cors"},t.next=7,(0,t.t0)(t.t1,t.t2);case 7:return e=t.sent,t.next=10,e.blob();case 10:return r=t.sent,t.next=13,createImageBitmap(r,{premultiplyAlpha:"none",colorSpaceConversion:"none"});case 13:return o=t.sent,_.width=o.width,_.height=o.height,R.drawImage(o,0,0,o.width,o.height),t.abrupt("return",Array.from({length:x*x},(function(t,e){var n=Math.floor(e/x),r=e%x,o=n/x*_.width,a=r/x*_.height,i=R.getImageData(o,a,1,1);return[i.data[1]/256,i.data[2]/256]})).flat());case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(t,e){for(var n=0;n<t.length;n++)t[n]=f.waves.heights[e[n]]},v=function(){var t=F(T().mark((function t(){var e,n,r,o;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:return e=t.sent,n=m(f.grid.idTable,e,2),r=m(f.nodes.idTable,e,2),o=m(f.roads.idTable,e,2),t.abrupt("return",[].concat(E(e),E(n),E(r),E(o)));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){var t=Array.from({length:x*x},(function(t,e){var n=Math.floor(e/x),r=e%x,o=Math.sin((n/x*1.25-.125)*Math.PI)*Math.sin((r/x*1.25-.125)*Math.PI)*2.75-1.25;return[.12*(-x/2+n),.12*(-x/2+r),(4*o+S(n/x*20,r/x*15,.3)+1.5*S(n/x*20,r/x*15,.85))/4]})).flat(),e=m(f.nodes.idTable,t,3),n=m(f.grid.idTable,t,3),r=m(f.roads.idTable,t,3);return[].concat(E(t),E(n),E(e),E(r))},p=function(){for(var t,e,n,r=g(),o=(t=new Array(f.grid.idTable.length).fill(0),e=m(f.nodes.idTable,f.nodes.connections,1),n=new Array(f.roads.idTable.length).fill(-2),[].concat(E(f.nodes.connections),E(t),E(e),E(n))),a=[],i=0;i<o.length;i++)a.push(r[3*i]),a.push(r[3*i+1]),a.push(r[3*i+2]),a.push(o[i]);return a};function m(t,e,n){for(var r=new Array(t.length),o=0;o<t.length;o++)for(var a=0;a<n;a++)r[o*n+a]=e[t[o]*n+a];return r}function y(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)for(var o=0;o<e;o++)n[r*e+o]=t[r]*e+o;return n}this.initBuffers=function(){function t(t,e){e[0]=O.getUniformLocation(t,"pjMatrix"),e[1]=O.getUniformLocation(t,"mvMatrix"),e[2]=O.getUniformLocation(t,"screenScale"),e[3]=O.getUniformLocation(t,"sheens"),e[4]=O.getUniformLocation(t,"nodeness"),e[5]=O.getUniformLocation(t,"gridness"),e[6]=O.getUniformLocation(t,"toponess")}var e,n,r,o=function(){var t=F(T().mark((function t(){var e,n,r;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v();case 2:e=t.sent,C=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,C),O.bufferData(O.ARRAY_BUFFER,new Float32Array(e),O.STATIC_DRAW),n=2*Float32Array.BYTES_PER_ELEMENT,0,r=n,N[2]=O.getAttribLocation(Y,"topology"),O.enableVertexAttribArray(N[2]),O.vertexAttribPointer(N[2],2,O.FLOAT,!1,r,0);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(function(){var t=p();k=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,k),O.bufferData(O.ARRAY_BUFFER,new Float32Array(t),O.STATIC_DRAW);var e=3*Float32Array.BYTES_PER_ELEMENT,n=0+e,r=e+1*Float32Array.BYTES_PER_ELEMENT;N[0]=O.getAttribLocation(Y,"position"),O.enableVertexAttribArray(N[0]),O.vertexAttribPointer(N[0],3,O.FLOAT,!1,r,0),N[1]=O.getAttribLocation(Y,"nconnection"),O.enableVertexAttribArray(N[1]),O.vertexAttribPointer(N[1],1,O.FLOAT,!1,r,n)})(),o(),z=new Float32Array(new Array(4*f.sheens.array.length).fill(0)),e=m(f.grid.idTable,f.waves.heights,1),n=m(f.nodes.idTable,f.waves.heights,1),r=m(f.roads.idTable,f.waves.heights,1),H=new Float32Array([].concat(E(f.waves.heights),E(e),E(n),E(r))),j=function(){var t=y(f.grid.idTable,1),e=y(f.nodes.idTable,1),n=y(f.roads.idTable,1);return E(Array(f.waves.heights.length).keys()).concat(E(t),E(e),E(n))}(),u(H,j),I=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,I),O.bufferData(O.ARRAY_BUFFER,new Float32Array(H),O.DYNAMIC_DRAW),N[3]=O.getAttribLocation(Y,"height"),O.enableVertexAttribArray(N[3]),O.vertexAttribPointer(N[3],1,O.FLOAT,!1,Float32Array.BYTES_PER_ELEMENT,0),O.useProgram(Y),t(Y,W),f.setImage(),O.useProgram(B),t(B,U)},this.setImage=F(T().mark((function t(){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:G;case 1:case"end":return t.stop()}}),t)}))),this.render=function(){if(requestAnimationFrame(f.render),f.ticker.frameReady()){f.ticker.frameStart(),f.camera.resized&&(D.width=f.camera.viewWidth,D.height=f.camera.viewHeight,O.viewport(0,0,f.camera.viewWidth,f.camera.viewHeight),f.camera.resized=!1),f.scene.update(f.ticker.timeDelta),f.sheens.update(f.ticker.timeDelta),f.waves.update(f.ticker.fixedTimeDelta),function(t){for(var e=0;e<f.sheens.array.length;e++)t[4*e]=f.sheens.array[e].origin[0],t[4*e+1]=f.sheens.array[e].origin[1],t[4*e+2]=f.sheens.array[e].angle[0],t[4*e+3]=f.sheens.array[e].angle[1]}(z),u(H,j);var t=function(t){O.uniformMatrix4fv(t[0],!1,f.camera.pjMatrix),O.uniformMatrix4fv(t[1],!1,f.camera.mvMatrix),O.uniform1f(t[2],f.camera.renderHeight),O.uniform2fv(t[3],z),O.uniform1f(t[4],f.scene.nodeness),O.uniform1f(t[5],f.scene.gridness),O.uniform1f(t[6],f.scene.toponess)};O.useProgram(Y),O.bindBuffer(O.ARRAY_BUFFER,I),O.bufferSubData(O.ARRAY_BUFFER,0,H),t(W),O.drawArrays(O.POINTS,f.waves.offset,f.waves.len),O.useProgram(B),O.bindBuffer(O.ARRAY_BUFFER,I),t(U),O.drawArrays(O.LINES,f.grid.offset,f.grid.len+f.roads.len+f.nodes.len),O.flush(),f.ticker.frameEnd()}},this.start=function(){f.initBuffers(),f.render()}},X=Math.floor(x/2);var Z=function(){var t=this,e=new Array(3),n=0,r=!0,o=.033;this.setInertia=function(t){n=t},this.setPositions=function(a){var c=a.x,f=a.y,l=a.z,u=a.sigma2;if(r)for(var h=0;h<3;h++){e[h]=new Array(x);for(var d=0;d<x;d++)e[h][d]=new Array(x)}for(var v=0;v<3;v++)for(var g=0;g<x;g++)for(var p=0;p<x;p++){var m=6*(-X+g),y=6*(-X+p),w=l*Math.exp(-(Math.pow(m-c,2)+Math.pow(y-f,2))/(2*u));e[0][g][p]=r||Math.abs(w)>Math.abs(e[0][g][p])?w:e[0][g][p]}for(var b=1;b<50;b++)for(var S=1;S<50;S++)e[1][b][S]=n*e[0][b][S]+8*o*o/1*(e[0][b+1][S]+e[0][b-1][S]+e[0][b][S+1]+e[0][b][S-1]-4*e[0][b][S]);i(1),s(1),r=!1,t.heights=new Array(x*x)},this.update=function(t){o=t;for(var r=1;r<x/2;r++)for(var c=1;c<x/2;c++)e[2][r][c]=n*(2*e[1][r][c]-e[0][r][c]+16*o*o/1*(e[1][r+1][c]+e[1][r-1][c]+e[1][r][c+1]+e[1][r][c-1]-4*e[1][r][c])),e[2][x-r-1][x-c-1]=e[2][r][c],e[2][r][x-c-1]=e[2][r][c],e[2][x-r-1][c]=e[2][r][c];i(2),s(2),a()};var a=function(){for(var n=0;n<x;n++)for(var r=0;r<x;r++)e[0][n][r]=e[1][n][r],e[1][n][r]=e[2][n][r],t.heights[n*x+r]=.02*e[1][n][r]},i=function(t){for(var n=1;n<50;n++)e[t][n][0]=e[t][n][1],e[t][n][50]=e[t][n][49],e[t][0][n]=e[t][1][n],e[t][50][n]=e[t][49][n]},s=function(t){e[t][0][0]=(e[t][0][1]+e[t][1][0])/2,e[t][0][50]=(e[t][0][49]+e[t][1][50])/2,e[t][50][0]=(e[t][49][0]+e[t][50][1])/2,e[t][50][50]=(e[t][49][50]+e[t][50][49])/2};this.offset=0,this.len=x*x};var Q=function(){for(var t=0,e=new Array(7600),n=0;n<x;n++)for(var r=0;r<x;r++)n<50&&(e[t++]=n*x+r,e[t++]=(n+1)*x+r),n<50&&r<50&&(e[t++]=n*x+r,e[t++]=(n+1)*x+r+1),r<50&&(e[t++]=n*x+r,e[t++]=n*x+r+1);this.offset=0,this.idTable=e,this.len=e.length};var $=function(){var t=this,e=[];this.connections=new Array(x*x).fill(0);for(var n=0;n<x*x;n++)this.connections[n]=Math.max(0,Math.floor(64*Math.random())-62);for(var r=function(n,r){if(t.connections[r]>0)return e.push(n),e.push(r),!0},o=0;o<x;o++)for(var a=0;a<x;a++){var i=o*x+a;if(0!=this.connections[i])for(var s=0,c=0;s<this.connections[i]+1&&c<x;){for(var f=0;f<c;f++){var l=a+f,u=o+c-f,h=o-c+f;l<x&&u<x&&r(i,u*x+l)&&s++,l<x&&h>=0&&r(i,h*x+l)&&s++}c++}}this.offset=0,this.len=e.length,this.idTable=e},q=[40,295,295,446,446,647,647,749,749,1051,1051,1407,1407,1509,1509,1610,1610,1658,1658,1706,1706,1857,1857,2005,2005,2104,2104,2252,2252,2300,2300,2348,2348,2346,1632,1639,1639,1900,1900,2055,2055,2209,2209,2569,51,882,882,883,883,1038,1038,1140,1140,1453,1453,1606,1606,1658,26,126,126,329,329,327,327,528,528,675,675,776,776,925,925,1076,1076,1074,1074,1326,204,931,931,986,986,988,988,1041,1041,1197,1197,1248,1248,1508,1508,1610,1610,1714,1714,1869,45,146,146,195,195,397,397,954,954,1158,1158,1413,1413,1669,1669,1920,1920,2020,2020,2070,2070,2168,2168,2166,2166,2313,2313,2310,2310,2358,2358,2456,2456,2403,2403,2450,2450,2448,1768,1869,1869,1968,1968,2067,2067,2065,2065,2113,2113,2111,2111,2209,2209,2257,2257,2304,2304,2399,2399,2450,18,272,272,377,377,429,429,583,583,636,636,788,788,838,838,1040,1040,1141,1141,1241,1241,1342,1342,1392,1392,1543,1543,1641,1641,1639,628,889,889,1099,1099,1307,1307,1411,1411,1412,1158,1259,1259,1409,1409,1509,816,869,869,971,971,1076,1076,1129,1129,1234,1234,1392,1392,1548,1548,1652,1652,1755,1755,2065,2584,2329,2329,2175,2175,2022,2022,2020,1325,1471,1471,1623,1623,1672,1672,1669,2022,1973,1973,1824,1824,1672,2070,2224,2224,2175,2578,2426,2426,2325,2325,2224,2567,2469,2469,2419,2419,2370,2370,2320,2320,2322,2322,2377,2377,2430,2430,2484,2484,2487,2487,2389,2389,2341,2341,2293,2293,2294,1623,1776,1776,1930,1930,2084,2084,2238,2238,2341,1631,1782,1782,1881,1881,1930,1543,1752,1752,1958,1958,2113];var J=function(){this.offset=0,this.idTable=q,this.len=this.idTable.length};function K(t,e,n){return(n-e)*t+e}var tt=[[1,0,.2],[.2,.8,.4],[1,1,1]],et=Array.from({length:9},(function(t,e){return tt[e%3][Math.floor(e/3)]})).join();var nt=function(){var t=this;this.str=et,this.array=[{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0},{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0},{inactive:!0,angle:[0,1],origin:[-4,-4],speed:0}],this.respawn=!1,this.active=!1,this.nextWave=null,this.set=function(e){t.active=!0,void 0!==(null==e?void 0:e.respawn)&&(t.respawn=e.respawn);var n=K(Math.random(),10,70)/45*2;if(t.array.forEach((function(t){var e=K((Math.random()+1)/2,-1.5,1.5);t.inactive=!1,t.speed=K(n/3+e,1,4),t.angle=[4*e-n,1],t.origin=[-4-4*e,-4-4*e]})),e&&e.sheens)for(var r=0;r<e.sheens.length;r++)Object.assign(t.array[r],e.sheens[r]);clearTimeout(t.nextWave)},this.update=function(n){t.active&&(t.active=!1,t.array.forEach((function(r){!r.inactive&&e(r,n),t.active=t.active||!r.inactive})),!t.active&&t.respawn&&(t.nextWave=setTimeout(t.set,2e3+3e3*Math.random())))};var e=function(t,e){var n=t.speed*e;t.angle[0]=Math.min(-.25,t.angle[0]+n/10),t.origin[0]+=n,t.origin[1]+=n,t.inactive=Math.max(t.origin[0],t.origin[1])>4}},rt={initialize:0,start:1,setSize:2,setInertia:3,setPositions:4,setSheens:5,setFPS:6,setProgress:7,setScene:8,loseCTX:9,setCamOffset:10,setCamAngle:11};var ot=new function(){var t=new o,e=new l,n=new u(e),r=new Z,a=new Q,i=new nt,s=new $,c=new J,f=new V(t,e,n,r,a,s,c,i);return this.init=function(t,e){f.initWebGL(t),f.initTextures(e),f.initShaders()},this.run=function(o,a){switch(rt[o]){case rt.start:f.start();break;case rt.setSize:e.updateSize(a.width,a.height);break;case rt.setProgress:f.setProgress(a);break;case rt.setCamOffset:e.updateNudge(a.pitchOffset,a.yawOffset);break;case rt.setCamAngle:e.updateAngle(a.pitch,a.yaw,a.roll,a.offsetX,a.offsetY,a.offsetZ);break;case rt.setInertia:r.setInertia(1-a*n.targetFPS/30);break;case rt.setPositions:r.setPositions(a);break;case rt.setSheens:i.set(a);break;case rt.setScene:t.target(a.name,a.speed);break;case rt.setFPS:n.setFPS(a);break;case rt.loseCTX:f.loseCTX()}},this}}}]);